<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ç¥æ—¥ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 2em;
            background: linear-gradient(135deg, #f0f8ff, #e6e6fa);
            color: #333;
        }

        h1 {
            font-size: 2rem;
            text-align: center;
            color: #4b0082;
            text-shadow: 1px 1px 2px #aaa;
        }

        label,
        input,
        button {
            font-size: 1rem;
            vertical-align: middle;
        }

        #controls {
            margin-bottom: 1em;
            text-align: center;
        }

        #controls div {
            margin-bottom: 1em;
        }

        #controls button {
            margin-left: 0.5em;
            padding: 0.5em 1em;
            border: none;
            border-radius: 5px;
            background-color: #4b0082;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #controls button:hover {
            background-color: #6a0dad;
            transform: scale(1.05);
        }

        #timestamp {
            color: #555;
            text-align: center;
            font-style: italic;
        }

        #result {
            margin-top: 1em;
            font-weight: bold;
            text-align: center;
            font-size: 1.2rem;
        }

        #monthHolidays {
            margin-top: 1.5em;
            text-align: center;
        }

        #monthHolidays h2 {
            font-size: 1.3rem;
            margin-bottom: 0.5em;
            color: #4b0082;
            text-shadow: 1px 1px 2px #aaa;
        }

        #monthHolidays ul {
            padding-left: 1.2em;
            list-style: none;
            text-align: left;
            display: inline-block;
        }

        #monthHolidays ul li {
            margin-bottom: 0.3em;
            padding: 0.3em;
            background: #f8f8ff;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #source {
            margin-top: 0em;
            font-size: 0.9rem;
            text-align: center;
        }

        #source a {
            color: #4b0082;
            text-decoration: none;
        }

        #source a:hover {
            text-decoration: underline;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c2c54, #1e1e2f);
                color: #ddd;
            }

            h1 {
                color: #a29bfe;
                text-shadow: 1px 1px 2px #000;
            }

            #controls button {
                background-color: #6c5ce7;
                color: #fff;
            }

            #controls button:hover {
                background-color: #a29bfe;
            }

            #timestamp {
                color: #aaa;
            }

            #monthHolidays ul li {
                background: #3a3a5c;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            }

            #source a {
                color: #a29bfe;
            }

            #monthHolidays h2 {
                color: #a29bfe;
                text-shadow: 1px 1px 2px #000;
            }
        }

        footer {
            text-align: center;
            margin-top: 2em;
            font-size: 0.9rem;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>ç¥æ—¥ãƒã‚§ãƒƒã‚«ãƒ¼</h1>

    <div id="controls">
        <div>
            <label for="datePicker">æ—¥ä»˜ã‚’é¸æŠï¼š</label>
            <input type="date" id="datePicker" />
        </div>
        <div>
            <button id="prevMonthBtn">å‰æœˆåŒæ—¥</button>
            <button id="prevDayBtn">å‰æ—¥</button>
            <button id="todayBtn">ä»Šæ—¥</button>
            <button id="nextDayBtn">ç¿Œæ—¥</button>
            <button id="nextMonthBtn">ç¿ŒæœˆåŒæ—¥</button>
        </div>
    </div>

    <div id="result"></div>

    <div id="monthHolidays">
        <h2 id="monthTitle"></h2>
        <ul id="monthList"></ul>
    </div>

    <!-- CSV ã®æœ€çµ‚æ›´æ–°æ—¥æ™‚ -->
    <div id="timestamp"></div>

    <!-- å–å¾—å…ƒãƒªãƒ³ã‚¯ -->
    <div id="source">
        ç¥æ—¥CSVå–å¾—å…ƒï¼š
        <a href="https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html" target="_blank" rel="noopener noreferrer">
            å†…é–£åºœã€Œå›½æ°‘ã®ç¥æ—¥ã€æ¦‚è¦ãƒšãƒ¼ã‚¸
        </a>
    </div>

    <!-- è‘—ä½œæ¨©è¡¨è¨˜ -->
    <footer>
        &copy; 2025 Iwata M. All rights reserved.
    </footer>

    <script>
        (async () => {
            // 1) CSVå–å¾—ï¼†Shift_JISãƒ‡ã‚³ãƒ¼ãƒ‰
            const resp = await fetch('syukujitsu.csv');
            if (!resp.ok) {
                document.getElementById('result').textContent = 'ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                return;
            }
            // Last-Modified ã®è¡¨ç¤º
            const lm = resp.headers.get('Last-Modified');
            if (lm) {
                const lmDate = new Date(lm);
                document.getElementById('timestamp').textContent =
                    `CSV æœ€çµ‚æ›´æ–°: ${lmDate.toLocaleString('ja-JP')}`;
            }
            const buf = await resp.arrayBuffer();
            const decoder = new TextDecoder('shift_jis');
            const csvText = decoder.decode(buf);

            // 2) CSVâ†’ãƒãƒƒãƒ—åŒ–
            const lines = csvText.split(/\r?\n/).filter(l => l.trim());
            const holidayMap = {};
            for (let i = 1; i < lines.length; i++) {
                const [raw, name] = lines[i].split(',');
                if (!raw || !name) continue;
                const [y, m, d] = raw.split('/');
                const iso = `${y.padStart(4, '0')}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
                holidayMap[iso] = name;
            }

            // 3) å’Œæš¦å¤‰æ›
            function toWareki(date) {
                const y = date.getFullYear(), m = date.getMonth() + 1, d = date.getDate();
                let era, start;
                if (y > 2019 || (y === 2019 && (m > 5 || (m === 5 && d >= 1)))) { era = 'ä»¤å’Œ'; start = 2019; }
                else if (y > 1989 || (y === 1989 && (m > 1 || (m === 1 && d >= 8)))) { era = 'å¹³æˆ'; start = 1989; }
                else if (y > 1926 || (y === 1926 && (m > 12 || (m === 12 && d >= 25)))) { era = 'æ˜­å’Œ'; start = 1926; }
                else if (y > 1912 || (y === 1912 && (m > 7 || (m === 7 && d >= 30)))) { era = 'å¤§æ­£'; start = 1912; }
                else { era = 'æ˜æ²»'; start = 1868; }
                const n = y - start + 1;
                return `${era}${n === 1 ? 'å…ƒ' : n}å¹´`;
            }

            // 4) æ›œæ—¥é…åˆ—
            const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

            // 5) UIè¦ç´ å–å¾—
            const picker = document.getElementById('datePicker');
            const prevMonthBtn = document.getElementById('prevMonthBtn');
            const prevDayBtn = document.getElementById('prevDayBtn');
            const todayBtn = document.getElementById('todayBtn');
            const nextDayBtn = document.getElementById('nextDayBtn');
            const nextMonthBtn = document.getElementById('nextMonthBtn');
            const result = document.getElementById('result');
            const monthTitle = document.getElementById('monthTitle');
            const monthList = document.getElementById('monthList');

            // æ—¥ä»˜ï¼†æœˆé–“ãƒªã‚¹ãƒˆæ›´æ–°
            function update() {
                const iso = picker.value;
                if (!iso) {
                    result.textContent = '';
                    monthTitle.textContent = '';
                    monthList.innerHTML = '';
                    return;
                }
                const dt = new Date(iso);
                const wareki = toWareki(dt);
                const monthDay = `${dt.getMonth() + 1}æœˆ${dt.getDate()}æ—¥`;
                const w = weekdays[dt.getDay()];
                const holiday = holidayMap[iso];
                result.textContent =
                    `${wareki} ${monthDay}ï¼ˆ${w}æ›œæ—¥ï¼‰: ` +
                    (holiday ? `ğŸ‰ ${holiday}` : 'ç¥æ—¥ã§ã¯ã‚ã‚Šã¾ã›ã‚“');

                const [year, month] = iso.split('-');
                monthTitle.textContent = `${year}å¹´${parseInt(month, 10)}æœˆã®ç¥æ—¥`;
                monthList.innerHTML = '';
                Object.entries(holidayMap)
                    .filter(([date]) => date.startsWith(`${year}-${month}`))
                    .sort(([a], [b]) => a.localeCompare(b))
                    .forEach(([date, name]) => {
                        const d = new Date(date);
                        const li = document.createElement('li');
                        li.textContent = `${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥: ${name}`;
                        monthList.appendChild(li);
                    });
            }

            // æ—¥ã‚·ãƒ•ãƒˆï¼æœˆã‚·ãƒ•ãƒˆï¼ä»Šæ—¥
            function shiftDay(offset) {
                const d = new Date(picker.value);
                d.setDate(d.getDate() + offset);
                picker.value = d.toISOString().slice(0, 10);
                update();
            }
            function shiftMonth(offset) {
                const d = new Date(picker.value);
                const original = d.getDate();
                d.setDate(1);
                d.setMonth(d.getMonth() + offset);
                const lastDay = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
                d.setDate(Math.min(original, lastDay));
                picker.value = d.toISOString().slice(0, 10);
                update();
            }
            function getLocalDate() {
                const now = new Date();
                const offset = now.getTimezoneOffset() * 60000; // ãƒŸãƒªç§’å˜ä½ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚ªãƒ•ã‚»ãƒƒãƒˆ
                return new Date(now.getTime() - offset).toISOString().slice(0, 10);
            }

            function goToday() {
                picker.value = getLocalDate();
                update();
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
            prevMonthBtn.addEventListener('click', () => shiftMonth(-1));
            prevDayBtn.addEventListener('click', () => shiftDay(-1));
            todayBtn.addEventListener('click', goToday);
            nextDayBtn.addEventListener('click', () => shiftDay(1));
            nextMonthBtn.addEventListener('click', () => shiftMonth(1));
            picker.addEventListener('change', update);

            // åˆæœŸè¨­å®š
            picker.value = getLocalDate();
            update();
        })();
    </script>
</body>

</html>